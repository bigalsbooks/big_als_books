<!DOCTYPE html>
<html lang="en">
<head>
  <title>Browse | Big Al's Books</title>
  <link rel="icon" href="bowex1/images/favicon.ico" type="image/x-icon">
  <meta name="description" content="Big Al's Books: A site for sharing memorable quotes and literary comments.">
    <meta name="keywords" content="books, quotes, writing, literature, Big Al's Books, bigalsbooks, Big Al,">
    <meta name="author" content="Big Al">
    <meta name="robots" content="index, follow">
  <style>
      html    {
          background-image:url(bowex1/images/cozy_library.jpg)
      }
    body {
        font-family: "Times New Roman", serif;
        background-image:url(bowex1/images/paper.jpg);
        color: #222;
        max-width: 700px;
        margin: 40px auto;
        line-height: 1.6;
        border: groove black 10px;
        padding: 20px
    }

    .navbar {
      background-color: #6c530c3b;
      padding: 10px 20px;
      margin-bottom: 30px;
      display: flex;
      gap: 20px;
      border-bottom: 2px solid #000;
    }

    .navbar a {
      text-decoration: none;
      font-weight: bold;
      color: #000;
    }

    .navbar a:hover {
      text-decoration: underline;
    }

    .quote-item {
      margin-bottom: 40px;
      padding-left: 15px;
      border-left: 4px solid #000;
      font-style: italic;
    }

    .quote-meta {
      margin-top: 5px;
      font-style: normal;
      font-size: 14px;
    }

    .vote-box {
      margin-top: 8px;
      font-size: 14px;
    }

    .vote-box button {
      font-family: "Times New Roman", serif;
      border: 1px solid #000;
      background: #eee;
      cursor: pointer;
      padding: 2px 6px;
    }

    .comment-form input,
    .comment-form textarea {
      display: block;
      width: 100%;
      margin: 4px 0;
    }
    
  </style>
</head>

<body>

  <nav class="navbar">
      <a href="index.html"><u>Home</u></a>
      <a href="submission.html"><u>Submit a Quote</u></a>
      <a href="browse.html"><u>Browse</u></a>
  </nav>

  <h1>Browse Submissions</h1>
  <p>Please keep your comments respectful.</p>

  <div id="quotes">Loading...</div>

  
  

<!-- Firebase Libraries -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { 
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDTd0z-wb7mpe3r-HbU5NAokr0ROeqEwZg",
    authDomain: "bigalsbookstore-a7c78.firebaseapp.com",
    projectId: "bigalsbookstore-a7c78",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const container = document.getElementById("quotes");

  function escapeHTML(text) {
    return (text || "").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }

  function formatDate(ts) {
    if (!ts) return "";
    const d = ts.toDate();
    return d.toLocaleDateString();
  }

  const q = query(collection(db, "quotes"), orderBy("createdAt", "desc"));

  onSnapshot(q, (snapshot) => {
    container.innerHTML = "";

    snapshot.forEach((doc) => {
      const data = doc.data();
      const id = doc.id;

      const div = document.createElement("div");
      div.className = "quote-item";

      div.innerHTML = `
        “${escapeHTML(data.quote)}”
        <div class="quote-meta">
          — ${escapeHTML(data.author)}, <em>${escapeHTML(data.book)}</em>
          <br>submitted by ${escapeHTML(data.name || "Anonymous")}
          <br><small>${formatDate(data.createdAt)}</small>
        </div>

        <details class="comments-box">
          <summary>Comments</summary>
          <div class="comments" id="comments-${id}"></div>

       <div class="comment-form">
          <input type="text" placeholder="Your name" id="name-${id}">
          <textarea placeholder="Write a comment…" id="text-${id}"></textarea>
         </div>

          <button data-id="${id}">Post</button>
        </details>
      `;

      // comment handler
      div.querySelector("button").onclick = async () => {
        const name = div.querySelector(`#name-${id}`).value.trim() || "Anonymous";
        const text = div.querySelector(`#text-${id}`).value.trim();
        if (!text) return;

        await addDoc(collection(db, "quotes", id, "comments"), {
          name,
          text,
          createdAt: serverTimestamp()
        });

        div.querySelector(`#text-${id}`).value = "";
      };

      container.appendChild(div);

      // live comments
      const commentsRef = query(
        collection(db, "quotes", id, "comments"),
        orderBy("createdAt", "asc")
      );

      const commentsBox = div.querySelector(`#comments-${id}`);

      onSnapshot(commentsRef, (snap) => {
        commentsBox.innerHTML = "";
        snap.forEach((c) => {
          const com = c.data();
          const p = document.createElement("div");
          p.className = "comment";

          p.innerHTML = `<strong>${escapeHTML(com.name)}</strong>: ${escapeHTML(com.text)}`;
          commentsBox.appendChild(p);
        });
      });
    });
  });
</script>







</body>
</html>





